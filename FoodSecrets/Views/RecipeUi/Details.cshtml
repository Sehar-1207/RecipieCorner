@model RecipeDetailsDto

@{
    ViewData["Title"] = "Details Recipe";
    Layout = "~/Views/Shared/_DetailsLayout.cshtml";

}

<div class="recipe-content-wrapper">
    <div class="recipe-header">
        <h1 class="recipe-title">@Model.Name</h1>
    </div>

    <div class="recipe-image-container">
        <img src="@(string.IsNullOrEmpty(Model.ImageUrl) ? "/images/default-recipe.png" : Model.ImageUrl)" class="recipe-hero-image" alt="@Model.Name" />
    </div>

    <div class="recipe-meta-bar">
        @* IMPORTANT: Please ensure these property names match your C# DTO class exactly. *@
        <span class="meta-item"><i class="fas fa-utensils"></i> Cuisine: <strong>@Model.Cusine</strong></span>
        <span class="meta-item"><i class="fas fa-tag"></i> Meal Type: <strong>@Model.MealType</strong></span>
        <span class="meta-item"><i class="fas fa-clock"></i> Time: <strong>@Model.AstimatedCookingTime.ToString("hh\\:mm")</strong></span>
    </div>

    <p class="recipe-description">@Model.Description</p>

    <div class="row">
        <div class="col-lg-5 mb-5 mb-lg-0">
            <h3 class="recipe-section-title">Ingredients</h3>
            @if (Model.Ingredients != null && Model.Ingredients.Any())
            {
                <ul class="ingredient-list">
                    @foreach (var ing in Model.Ingredients)
                    {
                        <li>
                            <span>@ing.Name - @ing.Quantity</span>
                            @if (User.IsInRole("Admin"))
                            {
                                <span class="admin-actions">
                                    <a asp-controller="IngredientUi" asp-action="Edit" asp-route-id="@ing.Id" class="btn btn-sm btn-outline-secondary py-0 px-2" title="Edit"><i class="fas fa-pencil-alt"></i></a>
                                    <a asp-controller="IngredientUi" asp-action="Delete" asp-route-id="@ing.Id" class="btn btn-sm btn-outline-danger py-0 px-2" title="Delete"><i class="fas fa-trash-alt"></i></a>
                                </span>
                            }
                        </li>
                    }
                </ul>
            }
            else
            {

                <p>No ingredients added yet.</p>
            }
        </div>

        <div class="col-lg-7">
            <h3 class="recipe-section-title">Instructions</h3>
            @if (Model.Instructions != null && Model.Instructions.Any())
            {
                <ol class="instruction-list">
                    @foreach (var step in Model.Instructions.OrderBy(i => i.Order))
                    {
                        <li>
                            <span class="instruction-text">@step.StepInstruction</span>
                            @if (User.IsInRole("Admin"))
                            {
                                <span class="admin-actions">
                                    <a asp-controller="InstructionUi" asp-action="Edit" asp-route-id="@step.Id" class="btn btn-sm btn-outline-secondary py-0 px-2" title="Edit"><i class="fas fa-pencil-alt"></i></a>
                                    <a asp-controller="InstructionUi" asp-action="Delete" asp-route-id="@step.Id" class="btn btn-sm btn-outline-danger py-0 px-2" title="Delete"><i class="fas fa-trash-alt"></i></a>
                                </span>
                            }
                        </li>
                    }
                </ol>
            }
            else
            {

                <p>No instructions added yet.</p>
            }
        </div>
    </div>

    <div class="mt-5">
        <h3 class="recipe-section-title">Ratings & Reviews</h3>
        @if (User.IsInRole("Admin"))
        {
            <a asp-controller="RatingUi" asp-action="Create" asp-route-recipeId="@Model.Id" class="btn btn-sm btn-primary float-end">Add Rating</a>
        }
        @if (Model.Ratings != null && Model.Ratings.Any())
        {
            <div class="mt-4">
                @foreach (var r in Model.Ratings)
                {
                    <div class="rating-card">
                        <div class="w-100">
                            <div class="rating-header">
                                <span class="rating-user">@r.UserId</span>
                                <span class="rating-stars">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        <i class="fa-star @(i <= r.Stars ? "fas" : "far")"></i>
                                    }
                                </span>
                            </div>
                            <p class="rating-comment">@r.Comment</p>
                            @if (User.IsInRole("Admin"))
                            {
                                <div class="text-end">
                                    <a asp-controller="RatingUi" asp-action="Edit" asp-route-id="@r.Id" class="btn btn-sm btn-outline-secondary">Edit</a>
                                    <a asp-controller="RatingUi" asp-action="Delete" asp-route-id="@r.Id" class="btn btn-sm btn-outline-danger">Delete</a>
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>
        }
        else
        {

            <p class="mt-4">No ratings have been submitted yet.</p>
        }
    </div>

    <div class="final-actions">
        @if (User.IsInRole("Admin"))
        {
            <a asp-action="Edit" asp-controller="RecipeUi" asp-route-id="@Model.Id" class="btn btn-primary">Edit Recipe</a>
        }
        <a asp-action="Index" asp-controller="RecipeUi" class="btn btn-secondary">Back to Recipe List</a>
    </div>
</div>
